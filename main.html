<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Question Bank Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      html[dir="rtl"] .choice-circle {
        margin-left: 0.75rem; /* ml-3 */
        margin-right: 0;
      }
      html[dir="rtl"] .fa-plus {
        margin-left: 0.5rem; /* ml-2 */
        margin-right: 0;
      }
      html[dir="rtl"] .fa-file-export {
        margin-left: 0.5rem; /* ml-2 */
        margin-right: 0;
      }
      html[dir="rtl"] .fa-trash-alt {
        margin-left: 0.5rem; /* ml-2 */
        margin-right: 0;
      }
      .choice-circle {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-weight: bold;
        color: white;
        flex-shrink: 0;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .question-card {
        transition: all 0.3s ease;
      }
      .question-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }
      .image-preview {
        max-height: 200px;
        object-fit: contain;
        border-radius: 8px;
      }
      .gradient-bg {
        background: linear-gradient(135deg, #6e8efb, #a777e3);
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <header
        class="gradient-bg text-white rounded-xl p-6 mb-8 shadow-lg relative"
      >
        <h1 class="text-3xl font-bold">Question Bank Creator</h1>
        <p class="opacity-90">
          Create, edit and manage your question bank with ease
        </p>
        <!-- Direction Toggle Button -->
        <button
          id="directionToggleBtn"
          title="Toggle Text Direction"
          class="absolute top-6 right-6 p-2 rounded-full hover:bg-white/20 transition-colors focus:outline-none focus:ring-2 focus:ring-white"
        >
          <i class="fas fa-arrows-alt-h text-xl"></i>
        </button>
      </header>

      <!-- Tabs Navigation -->
      <div class="flex border-b border-gray-200 mb-6">
        <button
          class="tab-btn py-2 px-4 font-medium text-gray-500 hover:text-purple-600 transition-all border-b-2 border-transparent hover:border-purple-300"
          data-tab="create"
        >
          Create Questions
        </button>
        <button
          class="tab-btn py-2 px-4 font-medium text-gray-500 hover:text-purple-600 transition-all border-b-2 border-transparent hover:border-purple-300"
          data-tab="edit"
        >
          Edit Questions
        </button>
        <button
          class="tab-btn py-2 px-4 font-medium text-gray-500 hover:text-purple-600 transition-all border-b-2 border-transparent hover:border-purple-300"
          data-tab="preview"
        >
          Preview
        </button>
      </div>

      <!-- Create Tab -->
      <div id="create" class="tab-content active">
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
          <h2 class="text-xl font-semibold mb-4 text-gray-800">
            Question Details
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Year</label
              >
              <select
                id="year"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
              >
                <option value="2014-2015">2014-2015</option>
                <option value="2015-2016">2015-2016</option>
                <option value="2016-2017">2016-2017</option>
                <option value="2017-2018">2017-2018</option>
                <option value="2018-2019">2018-2019</option>
                <option value="2019-2020">2019-2020</option>
                <option value="2020-2021">2020-2021</option>
                <option value="2021-2022">2021-2022</option>
                <option value="2022-2023">2022-2023</option>
                <option value="2023-2024">2023-2024</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Subject</label
              >
              <input
                type="text"
                id="subject"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                placeholder="Enter subject name"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Term</label
              >
              <select
                id="term"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
              >
                <option value="First Term">First Term</option>
                <option value="Second Term">Second Term</option>
              </select>
            </div>
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Question</label
            >
            <textarea
              id="question"
              rows="3"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 question-input"
              placeholder="Enter your question here..."
            ></textarea>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="flex items-center">
              <div class="choice-circle bg-blue-500 mr-3">A</div>
              <input
                type="text"
                id="choiceA"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 question-input"
                placeholder="Choice A"
              />
            </div>
            <div class="flex items-center">
              <div class="choice-circle bg-green-500 mr-3">B</div>
              <input
                type="text"
                id="choiceB"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 question-input"
                placeholder="Choice B"
              />
            </div>
            <div class="flex items-center">
              <div class="choice-circle bg-yellow-500 mr-3">C</div>
              <input
                type="text"
                id="choiceC"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 question-input"
                placeholder="Choice C"
              />
            </div>
            <div class="flex items-center">
              <div class="choice-circle bg-red-500 mr-3">D</div>
              <input
                type="text"
                id="choiceD"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 question-input"
                placeholder="Choice D"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Correct Answer</label
              >
              <select
                id="correctAnswer"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
              >
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Image (Optional)</label
              >
              <div class="flex items-center">
                <input
                  type="file"
                  id="questionImage"
                  accept="image/*"
                  class="hidden"
                />
                <button
                  id="uploadBtn"
                  class="px-4 py-2 bg-gray-200 text-gray-700 rounded-l-md hover:bg-gray-300 transition"
                >
                  Choose Image
                </button>
                <span
                  id="fileName"
                  class="px-3 py-2 bg-gray-100 text-gray-500 rounded-r-md flex-1 truncate"
                  >No image selected</span
                >
              </div>
              <div id="imagePreviewContainer" class="mt-2 hidden">
                <img
                  id="imagePreview"
                  class="image-preview w-full border border-gray-200"
                />
                <button
                  id="removeImageBtn"
                  class="mt-2 text-sm text-red-500 hover:text-red-700"
                >
                  Remove Image
                </button>
              </div>
            </div>
          </div>

          <div class="flex justify-end">
            <button
              id="addQuestionBtn"
              class="px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition flex items-center"
            >
              <i class="fas fa-plus mr-2"></i> Add Question
            </button>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-md p-6">
          <h2 class="text-xl font-semibold mb-4 text-gray-800">
            Question Bank (<span id="questionCount">0</span> questions)
          </h2>

          <div id="questionsList" class="space-y-4">
            <!-- Questions will be added here -->
            <div class="text-center text-gray-500 py-8" id="emptyState">
              <i class="fas fa-question-circle text-4xl mb-2 opacity-30"></i>
              <p>No questions added yet</p>
            </div>
          </div>

          <div class="mt-6 flex justify-between items-center">
            <button
              id="exportBtn"
              class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition flex items-center"
            >
              <i class="fas fa-file-export mr-2"></i> Export to JSON
            </button>
            <button
              id="clearAllBtn"
              class="px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition flex items-center"
            >
              <i class="fas fa-trash-alt mr-2"></i> Clear All
            </button>
          </div>
        </div>
      </div>

      <!-- Edit Tab -->
      <div id="edit" class="tab-content">
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
          <h2 class="text-xl font-semibold mb-4 text-gray-800">
            Import Question Bank
          </h2>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Import JSON File</label
            >
            <div class="flex items-center">
              <input
                type="file"
                id="importFile"
                accept=".json"
                class="hidden"
              />
              <button
                id="importBtn"
                class="px-4 py-2 bg-blue-500 text-white rounded-l-md hover:bg-blue-600 transition"
              >
                Choose File
              </button>
              <span
                id="importFileName"
                class="px-3 py-2 bg-gray-100 text-gray-500 rounded-r-md flex-1 truncate"
                >No file selected</span
              >
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Filter by Year</label
              >
              <select
                id="filterYear"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="">All Years</option>
                <option value="2014-2015">2014-2015</option>
                <option value="2015-2016">2015-2016</option>
                <option value="2016-2017">2016-2017</option>
                <option value="2017-2018">2017-2018</option>
                <option value="2018-2019">2018-2019</option>
                <option value="2019-2020">2019-2020</option>
                <option value="2020-2021">2020-2021</option>
                <option value="2021-2022">2021-2022</option>
                <option value="2022-2023">2022-2023</option>
                <option value="2023-2024">2023-2024</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Filter by Subject</label
              >
              <input
                type="text"
                id="filterSubject"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="Filter by subject"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Filter by Term</label
              >
              <select
                id="filterTerm"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="">All Terms</option>
                <option value="First Term">First Term</option>
                <option value="Second Term">Second Term</option>
              </select>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-md p-6">
          <h2 class="text-xl font-semibold mb-4 text-gray-800">
            Edit Questions (<span id="editQuestionCount">0</span> questions)
          </h2>

          <div id="editQuestionsList" class="space-y-4">
            <!-- Questions for editing will be added here -->
            <div class="text-center text-gray-500 py-8" id="editEmptyState">
              <i class="fas fa-question-circle text-4xl mb-2 opacity-30"></i>
              <p>No questions to edit. Import a JSON file first.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Preview Tab -->
      <div id="preview" class="tab-content">
        <div class="bg-white rounded-xl shadow-md p-6">
          <h2 class="text-xl font-semibold mb-4 text-gray-800">
            Question Bank Preview
          </h2>

          <div id="previewContent" class="text-center text-gray-500 py-8">
            <i class="fas fa-eye text-4xl mb-2 opacity-30"></i>
            <p>No questions to preview. Create or import questions first.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Question Modal -->
    <div
      id="editModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-white rounded-xl shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold text-gray-800">Edit Question</h3>
          <button id="closeEditModal" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Year</label
              >
              <select
                id="editYear"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"
              >
                <option value="2014-2015">2014-2015</option>
                <option value="2015-2016">2015-2016</option>
                <option value="2016-2017">2016-2017</option>
                <option value="2017-2018">2017-2018</option>
                <option value="2018-2019">2018-2019</option>
                <option value="2019-2020">2019-2020</option>
                <option value="2020-2021">2020-2021</option>
                <option value="2021-2022">2021-2022</option>
                <option value="2022-2023">2022-2023</option>
                <option value="2023-2024">2023-2024</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Subject</label
              >
              <input
                type="text"
                id="editSubject"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Term</label
              >
              <select
                id="editTerm"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"
              >
                <option value="First Term">First Term</option>
                <option value="Second Term">Second Term</option>
              </select>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Question</label
            >
            <textarea
              id="editQuestion"
              rows="3"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"
            ></textarea>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="flex items-center">
              <div class="choice-circle bg-blue-500 mr-3">A</div>
              <input
                type="text"
                id="editChoiceA"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"
              />
            </div>
            <div class="flex items-center">
              <div class="choice-circle bg-green-500 mr-3">B</div>
              <input
                type="text"
                id="editChoiceB"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"
              />
            </div>
            <div class="flex items-center">
              <div class="choice-circle bg-yellow-500 mr-3">C</div>
              <input
                type="text"
                id="editChoiceC"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"
              />
            </div>
            <div class="flex items-center">
              <div class="choice-circle bg-red-500 mr-3">D</div>
              <input
                type="text"
                id="editChoiceD"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Correct Answer</label
              >
              <select
                id="editCorrectAnswer"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"
              >
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Image (Optional)</label
              >
              <div class="flex items-center">
                <input
                  type="file"
                  id="editQuestionImage"
                  accept="image/*"
                  class="hidden"
                />
                <button
                  id="editUploadBtn"
                  class="px-4 py-2 bg-gray-200 text-gray-700 rounded-l-md hover:bg-gray-300 transition"
                >
                  Choose Image
                </button>
                <span
                  id="editFileName"
                  class="px-3 py-2 bg-gray-100 text-gray-500 rounded-r-md flex-1 truncate"
                  >No image selected</span
                >
              </div>
              <div id="editImagePreviewContainer" class="mt-2 hidden">
                <img
                  id="editImagePreview"
                  class="image-preview w-full border border-gray-200"
                />
                <button
                  id="editRemoveImageBtn"
                  class="mt-2 text-sm text-red-500 hover:text-red-700"
                >
                  Remove Image
                </button>
              </div>
            </div>
          </div>

          <div class="flex justify-end space-x-3 pt-4">
            <button
              id="cancelEditBtn"
              class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition"
            >
              Cancel
            </button>
            <button
              id="saveEditBtn"
              class="px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition"
            >
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let questions = [];
      let currentEditIndex = -1;
      let imageBase64 = null;
      let editImageBase64 = null;

      // DOM Elements
      const directionToggleBtn = document.getElementById("directionToggleBtn");
      const tabBtns = document.querySelectorAll(".tab-btn");
      const tabContents = document.querySelectorAll(".tab-content");
      const questionInputs = document.querySelectorAll(".question-input");
      const addQuestionBtn = document.getElementById("addQuestionBtn");
      const questionsList = document.getElementById("questionsList");
      const emptyState = document.getElementById("emptyState");
      const questionCount = document.getElementById("questionCount");
      const exportBtn = document.getElementById("exportBtn");
      const clearAllBtn = document.getElementById("clearAllBtn");
      const uploadBtn = document.getElementById("uploadBtn");
      const questionImage = document.getElementById("questionImage");
      const fileName = document.getElementById("fileName");
      const imagePreviewContainer = document.getElementById(
        "imagePreviewContainer"
      );
      const imagePreview = document.getElementById("imagePreview");
      const removeImageBtn = document.getElementById("removeImageBtn");
      const importBtn = document.getElementById("importBtn");
      const importFile = document.getElementById("importFile");
      const importFileName = document.getElementById("importFileName");
      const editQuestionsList = document.getElementById("editQuestionsList");
      const editEmptyState = document.getElementById("editEmptyState");
      const editQuestionCount = document.getElementById("editQuestionCount");
      const filterYear = document.getElementById("filterYear");
      const filterSubject = document.getElementById("filterSubject");
      const filterTerm = document.getElementById("filterTerm");
      const previewContent = document.getElementById("previewContent");
      const editModal = document.getElementById("editModal");
      const closeEditModal = document.getElementById("closeEditModal");
      const cancelEditBtn = document.getElementById("cancelEditBtn");
      const saveEditBtn = document.getElementById("saveEditBtn");
      const editUploadBtn = document.getElementById("editUploadBtn");
      const editQuestionImage = document.getElementById("editQuestionImage");
      const editFileName = document.getElementById("editFileName");
      const editImagePreviewContainer = document.getElementById(
        "editImagePreviewContainer"
      );
      const editImagePreview = document.getElementById("editImagePreview");
      const editRemoveImageBtn = document.getElementById("editRemoveImageBtn");

      // Initialize the app
      function init() {
        applyInitialDirection();
        loadFromLocalStorage();
        setupEventListeners();
        updateQuestionCount();
        updateEditQuestionCount();
      }

      // Set up event listeners
      function setupEventListeners() {
        // Direction toggle
        directionToggleBtn.addEventListener("click", toggleTextDirection);

        // Tab switching
        tabBtns.forEach((btn) => {
          btn.addEventListener("click", () => {
            const tabId = btn.getAttribute("data-tab");
            switchTab(tabId);
          });
        });

        // Question input highlighting
        questionInputs.forEach((input) => {
          input.addEventListener("input", () => {
            input.classList.add("bg-yellow-100");
          });
        });

        // Add question button
        addQuestionBtn.addEventListener("click", addQuestion);

        // Export button
        exportBtn.addEventListener("click", exportToJson);

        // Clear all button
        clearAllBtn.addEventListener("click", clearAllQuestions);

        // Image upload
        uploadBtn.addEventListener("click", () => questionImage.click());
        questionImage.addEventListener("change", handleImageUpload);
        removeImageBtn.addEventListener("click", removeImage);

        // Import functionality
        importBtn.addEventListener("click", () => importFile.click());
        importFile.addEventListener("change", handleFileImport);

        // Filters for edit tab
        filterYear.addEventListener("change", filterQuestions);
        filterSubject.addEventListener("input", filterQuestions);
        filterTerm.addEventListener("change", filterQuestions);

        // Edit modal
        closeEditModal.addEventListener("click", closeModal);
        cancelEditBtn.addEventListener("click", closeModal);
        saveEditBtn.addEventListener("click", saveEditedQuestion);
        editUploadBtn.addEventListener("click", () =>
          editQuestionImage.click()
        );
        editQuestionImage.addEventListener("change", handleEditImageUpload);
        editRemoveImageBtn.addEventListener("click", removeEditImage);
      }

      // Handle text direction
      function toggleTextDirection() {
        const htmlEl = document.documentElement;
        const currentDir = htmlEl.getAttribute("dir") || "ltr";
        const newDir = currentDir === "ltr" ? "rtl" : "ltr";
        htmlEl.setAttribute("dir", newDir);
        localStorage.setItem("textDirection", newDir);
      }

      function applyInitialDirection() {
        const savedDir = localStorage.getItem("textDirection");
        if (savedDir) {
          document.documentElement.setAttribute("dir", savedDir);
        }
      }

      // Switch between tabs
      function switchTab(tabId) {
        tabContents.forEach((content) => {
          content.classList.remove("active");
          if (content.id === tabId) {
            content.classList.add("active");
          }
        });

        tabBtns.forEach((btn) => {
          btn.classList.remove("border-purple-600", "text-purple-600");
          if (btn.getAttribute("data-tab") === tabId) {
            btn.classList.add("border-purple-600", "text-purple-600");
          }
        });

        if (tabId === "preview") {
          renderPreview();
        }
      }

      // Add a new question
      function addQuestion() {
        const year = document.getElementById("year").value;
        const subject = document.getElementById("subject").value.trim();
        const term = document.getElementById("term").value;
        const question = document.getElementById("question").value.trim();
        const choiceA = document.getElementById("choiceA").value.trim();
        const choiceB = document.getElementById("choiceB").value.trim();
        const choiceC = document.getElementById("choiceC").value.trim();
        const choiceD = document.getElementById("choiceD").value.trim();
        const correctAnswer = document.getElementById("correctAnswer").value;

        // Validate inputs
        if (
          !subject ||
          !question ||
          !choiceA ||
          !choiceB ||
          !choiceC ||
          !choiceD
        ) {
          alert("Please fill in all required fields");
          return;
        }

        // Create question object
        const questionObj = {
          id: Date.now(),
          year,
          subject,
          term,
          question,
          choices: {
            A: choiceA,
            B: choiceB,
            C: choiceC,
            D: choiceD,
          },
          correctAnswer,
          image: imageBase64 || null,
        };

        // Add to questions array
        questions.push(questionObj);

        // Save to local storage
        saveToLocalStorage();

        // Render the question in the list
        renderQuestion(questionObj);

        // Clear form inputs (except year, subject, term)
        clearQuestionForm();

        // Update question count
        updateQuestionCount();
      }

      // Clear the question form
      function clearQuestionForm() {
        document.getElementById("question").value = "";
        document.getElementById("choiceA").value = "";
        document.getElementById("choiceB").value = "";
        document.getElementById("choiceC").value = "";
        document.getElementById("choiceD").value = "";
        document.getElementById("correctAnswer").value = "A";

        // Remove yellow background
        questionInputs.forEach((input) => {
          input.classList.remove("bg-yellow-100");
        });

        // Clear image
        removeImage();
      }

      // Render a question in the list
      function renderQuestion(questionObj) {
        // Hide empty state if it's the first question
        if (questions.length === 1) {
          emptyState.classList.add("hidden");
        }

        const questionElement = document.createElement("div");
        questionElement.className =
          "question-card bg-white border border-gray-200 rounded-lg p-4 shadow-sm";
        questionElement.dataset.id = questionObj.id;

        questionElement.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded">${
                          questionObj.year
                        }</span>
                        <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded ml-1">${
                          questionObj.subject
                        }</span>
                        <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded ml-1">${
                          questionObj.term
                        }</span>
                    </div>
                    <button class="edit-btn text-purple-600 hover:text-purple-800" data-id="${
                      questionObj.id
                    }">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
                <p class="font-medium text-gray-800 mb-2">${
                  questionObj.question
                }</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
                    <div class="flex items-center">
                        <div class="choice-circle bg-blue-500 mr-2">A</div>
                        <span class="text-sm ${
                          questionObj.correctAnswer === "A"
                            ? "font-bold text-green-600"
                            : "text-gray-700"
                        }">${questionObj.choices.A}</span>
                    </div>
                    <div class="flex items-center">
                        <div class="choice-circle bg-green-500 mr-2">B</div>
                        <span class="text-sm ${
                          questionObj.correctAnswer === "B"
                            ? "font-bold text-green-600"
                            : "text-gray-700"
                        }">${questionObj.choices.B}</span>
                    </div>
                    <div class="flex items-center">
                        <div class="choice-circle bg-yellow-500 mr-2">C</div>
                        <span class="text-sm ${
                          questionObj.correctAnswer === "C"
                            ? "font-bold text-green-600"
                            : "text-gray-700"
                        }">${questionObj.choices.C}</span>
                    </div>
                    <div class="flex items-center">
                        <div class="choice-circle bg-red-500 mr-2">D</div>
                        <span class="text-sm ${
                          questionObj.correctAnswer === "D"
                            ? "font-bold text-green-600"
                            : "text-gray-700"
                        }">${questionObj.choices.D}</span>
                    </div>
                </div>
                ${
                  questionObj.image
                    ? '<div class="mt-2"><span class="text-xs text-gray-500">Contains image</span></div>'
                    : ""
                }
            `;

        questionsList.appendChild(questionElement);

        // Add event listener to edit button
        questionElement
          .querySelector(".edit-btn")
          .addEventListener("click", (e) => {
            const questionId = parseInt(
              e.currentTarget.getAttribute("data-id")
            );
            openEditModal(questionId);
          });
      }

      // Open edit modal with question data
      function openEditModal(questionId) {
        const questionIndex = questions.findIndex((q) => q.id === questionId);
        if (questionIndex === -1) return;

        currentEditIndex = questionIndex;
        const question = questions[questionIndex];

        // Fill the modal with question data
        document.getElementById("editYear").value = question.year;
        document.getElementById("editSubject").value = question.subject;
        document.getElementById("editTerm").value = question.term;
        document.getElementById("editQuestion").value = question.question;
        document.getElementById("editChoiceA").value = question.choices.A;
        document.getElementById("editChoiceB").value = question.choices.B;
        document.getElementById("editChoiceC").value = question.choices.C;
        document.getElementById("editChoiceD").value = question.choices.D;
        document.getElementById("editCorrectAnswer").value =
          question.correctAnswer;

        // Handle image
        editImageBase64 = question.image || null;
        if (editImageBase64) {
          editImagePreview.src = editImageBase64;
          editImagePreviewContainer.classList.remove("hidden");
          editFileName.textContent = "Image loaded";
        } else {
          editImagePreviewContainer.classList.add("hidden");
          editFileName.textContent = "No image selected";
        }

        // Show modal
        editModal.classList.remove("hidden");
      }

      // Close edit modal
      function closeModal() {
        editModal.classList.add("hidden");
        currentEditIndex = -1;
        editImageBase64 = null;
      }

      // Save edited question
      function saveEditedQuestion() {
        if (currentEditIndex === -1) return;

        const question = questions[currentEditIndex];

        // Update question data
        question.year = document.getElementById("editYear").value;
        question.subject = document.getElementById("editSubject").value.trim();
        question.term = document.getElementById("editTerm").value;
        question.question = document
          .getElementById("editQuestion")
          .value.trim();
        question.choices.A = document
          .getElementById("editChoiceA")
          .value.trim();
        question.choices.B = document
          .getElementById("editChoiceB")
          .value.trim();
        question.choices.C = document
          .getElementById("editChoiceC")
          .value.trim();
        question.choices.D = document
          .getElementById("editChoiceD")
          .value.trim();
        question.correctAnswer =
          document.getElementById("editCorrectAnswer").value;
        question.image = editImageBase64 || null;

        // Save to local storage
        saveToLocalStorage();

        // Update the question in the UI
        updateQuestionInList(question);

        // Close modal
        closeModal();
      }

      // Update question in the list
      function updateQuestionInList(question) {
        const questionElement = document.querySelector(
          `.question-card[data-id="${question.id}"]`
        );
        if (questionElement) {
          questionElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded">${
                              question.year
                            }</span>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded ml-1">${
                              question.subject
                            }</span>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded ml-1">${
                              question.term
                            }</span>
                        </div>
                        <button class="edit-btn text-purple-600 hover:text-purple-800" data-id="${
                          question.id
                        }">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                    <p class="font-medium text-gray-800 mb-2">${
                      question.question
                    }</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
                        <div class="flex items-center">
                            <div class="choice-circle bg-blue-500 mr-2">A</div>
                            <span class="text-sm ${
                              question.correctAnswer === "A"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.A}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="choice-circle bg-green-500 mr-2">B</div>
                            <span class="text-sm ${
                              question.correctAnswer === "B"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.B}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="choice-circle bg-yellow-500 mr-2">C</div>
                            <span class="text-sm ${
                              question.correctAnswer === "C"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.C}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="choice-circle bg-red-500 mr-2">D</div>
                            <span class="text-sm ${
                              question.correctAnswer === "D"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.D}</span>
                        </div>
                    </div>
                    ${
                      question.image
                        ? '<div class="mt-2"><span class="text-xs text-gray-500">Contains image</span></div>'
                        : ""
                    }
                `;

          // Re-add event listener to edit button
          questionElement
            .querySelector(".edit-btn")
            .addEventListener("click", (e) => {
              const questionId = parseInt(
                e.currentTarget.getAttribute("data-id")
              );
              openEditModal(questionId);
            });
        }
      }

      // Handle image upload
      function handleImageUpload(e) {
        const file = e.target.files[0];
        if (!file) return;

        fileName.textContent = file.name;

        const reader = new FileReader();
        reader.onload = function (event) {
          imageBase64 = event.target.result;
          imagePreview.src = imageBase64;
          imagePreviewContainer.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }

      // Remove image
      function removeImage() {
        imageBase64 = null;
        questionImage.value = "";
        fileName.textContent = "No image selected";
        imagePreviewContainer.classList.add("hidden");
      }

      // Handle edit image upload
      function handleEditImageUpload(e) {
        const file = e.target.files[0];
        if (!file) return;

        editFileName.textContent = file.name;

        const reader = new FileReader();
        reader.onload = function (event) {
          editImageBase64 = event.target.result;
          editImagePreview.src = editImageBase64;
          editImagePreviewContainer.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }

      // Remove edit image
      function removeEditImage() {
        editImageBase64 = null;
        editQuestionImage.value = "";
        editFileName.textContent = "No image selected";
        editImagePreviewContainer.classList.add("hidden");
      }

      // Export questions to JSON
      function exportToJson() {
        if (questions.length === 0) {
          alert("No questions to export");
          return;
        }

        const dataStr = JSON.stringify(questions, null, 2);
        const dataUri =
          "data:application/json;charset=utf-8," + encodeURIComponent(dataStr);

        const exportFileDefaultName = `question-bank-${new Date()
          .toISOString()
          .slice(0, 10)}.json`;

        const linkElement = document.createElement("a");
        linkElement.setAttribute("href", dataUri);
        linkElement.setAttribute("download", exportFileDefaultName);
        linkElement.click();
      }

      // Handle file import
      function handleFileImport(e) {
        const file = e.target.files[0];
        if (!file) return;

        importFileName.textContent = file.name;

        const reader = new FileReader();
        reader.onload = function (event) {
          try {
            const importedQuestions = JSON.parse(event.target.result);

            if (!Array.isArray(importedQuestions)) {
              throw new Error("Invalid format: Expected an array of questions");
            }

            // Validate each question
            const validQuestions = importedQuestions.filter(
              (q) =>
                q.year &&
                q.subject &&
                q.term &&
                q.question &&
                q.choices &&
                q.choices.A &&
                q.choices.B &&
                q.choices.C &&
                q.choices.D &&
                q.correctAnswer
            );

            if (validQuestions.length === 0) {
              throw new Error("No valid questions found in the file");
            }

            // Add to questions array
            questions = validQuestions;

            // Save to local storage
            saveToLocalStorage();

            // Render questions in edit tab
            renderEditQuestions();

            // Update counts
            updateQuestionCount();
            updateEditQuestionCount();

            alert(`Successfully imported ${validQuestions.length} question(s)`);
          } catch (error) {
            alert(`Error importing questions: ${error.message}`);
          }
        };
        reader.readAsText(file);
      }

      // Render questions in edit tab
      function renderEditQuestions() {
        editQuestionsList.innerHTML = "";

        if (questions.length === 0) {
          editEmptyState.classList.remove("hidden");
          return;
        }

        editEmptyState.classList.add("hidden");

        questions.forEach((question, index) => {
          const questionElement = document.createElement("div");
          questionElement.className =
            "question-card bg-white border border-gray-200 rounded-lg p-4 shadow-sm";
          questionElement.dataset.id = question.id;

          questionElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded">${
                              question.year
                            }</span>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded ml-1">${
                              question.subject
                            }</span>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded ml-1">${
                              question.term
                            }</span>
                        </div>
                        <button class="edit-btn text-purple-600 hover:text-purple-800" data-id="${
                          question.id
                        }">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                    <p class="font-medium text-gray-800 mb-2">${
                      question.question
                    }</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
                        <div class="flex items-center">
                            <div class="choice-circle bg-blue-500 mr-2">A</div>
                            <span class="text-sm ${
                              question.correctAnswer === "A"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.A}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="choice-circle bg-green-500 mr-2">B</div>
                            <span class="text-sm ${
                              question.correctAnswer === "B"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.B}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="choice-circle bg-yellow-500 mr-2">C</div>
                            <span class="text-sm ${
                              question.correctAnswer === "C"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.C}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="choice-circle bg-red-500 mr-2">D</div>
                            <span class="text-sm ${
                              question.correctAnswer === "D"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.D}</span>
                        </div>
                    </div>
                    ${
                      question.image
                        ? '<div class="mt-2"><span class="text-xs text-gray-500">Contains image</span></div>'
                        : ""
                    }
                `;

          editQuestionsList.appendChild(questionElement);

          // Add event listener to edit button
          questionElement
            .querySelector(".edit-btn")
            .addEventListener("click", (e) => {
              const questionId = parseInt(
                e.currentTarget.getAttribute("data-id")
              );
              openEditModal(questionId);
            });
        });
      }

      // Filter questions in edit tab
      function filterQuestions() {
        const yearFilter = filterYear.value;
        const subjectFilter = filterSubject.value.toLowerCase();
        const termFilter = filterTerm.value;

        const filteredQuestions = questions.filter((question) => {
          const matchesYear = !yearFilter || question.year === yearFilter;
          const matchesSubject =
            !subjectFilter ||
            question.subject.toLowerCase().includes(subjectFilter);
          const matchesTerm = !termFilter || question.term === termFilter;

          return matchesYear && matchesSubject && matchesTerm;
        });

        editQuestionsList.innerHTML = "";

        if (filteredQuestions.length === 0) {
          editEmptyState.classList.remove("hidden");
          editEmptyState.innerHTML = `
                    <i class="fas fa-search text-4xl mb-2 opacity-30"></i>
                    <p>No questions match your filters</p>
                `;
          return;
        }

        editEmptyState.classList.add("hidden");

        filteredQuestions.forEach((question) => {
          const questionElement = document.createElement("div");
          questionElement.className =
            "question-card bg-white border border-gray-200 rounded-lg p-4 shadow-sm";
          questionElement.dataset.id = question.id;

          questionElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded">${
                              question.year
                            }</span>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded ml-1">${
                              question.subject
                            }</span>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded ml-1">${
                              question.term
                            }</span>
                        </div>
                        <button class="edit-btn text-purple-600 hover:text-purple-800" data-id="${
                          question.id
                        }">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                    <p class="font-medium text-gray-800 mb-2">${
                      question.question
                    }</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
                        <div class="flex items-center">
                            <div class="choice-circle bg-blue-500 mr-2">A</div>
                            <span class="text-sm ${
                              question.correctAnswer === "A"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.A}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="choice-circle bg-green-500 mr-2">B</div>
                            <span class="text-sm ${
                              question.correctAnswer === "B"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.B}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="choice-circle bg-yellow-500 mr-2">C</div>
                            <span class="text-sm ${
                              question.correctAnswer === "C"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.C}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="choice-circle bg-red-500 mr-2">D</div>
                            <span class="text-sm ${
                              question.correctAnswer === "D"
                                ? "font-bold text-green-600"
                                : "text-gray-700"
                            }">${question.choices.D}</span>
                        </div>
                    </div>
                    ${
                      question.image
                        ? '<div class="mt-2"><span class="text-xs text-gray-500">Contains image</span></div>'
                        : ""
                    }
                `;

          editQuestionsList.appendChild(questionElement);

          // Add event listener to edit button
          questionElement
            .querySelector(".edit-btn")
            .addEventListener("click", (e) => {
              const questionId = parseInt(
                e.currentTarget.getAttribute("data-id")
              );
              openEditModal(questionId);
            });
        });
      }

      // Render preview
      function renderPreview() {
        if (questions.length === 0) {
          previewContent.innerHTML = `
                    <i class="fas fa-eye text-4xl mb-2 opacity-30"></i>
                    <p>No questions to preview. Create or import questions first.</p>
                `;
          return;
        }

        let previewHTML = `
                <div class="text-right mb-4">
                    <span class="text-sm font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded">${questions.length} questions</span>
                </div>
                <div class="space-y-6">
            `;

        questions.forEach((question, index) => {
          previewHTML += `
                    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm text-left">
                        <div class="flex flex-wrap gap-2 mb-3">
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded">Question ${
                              index + 1
                            }</span>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded">${
                              question.year
                            }</span>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded">${
                              question.subject
                            }</span>
                            <span class="text-xs font-medium bg-gray-100 text-gray-600 px-2 py-1 rounded">${
                              question.term
                            }</span>
                        </div>
                        <p class="font-medium text-lg text-gray-800 mb-4">${
                          question.question
                        }</p>
                        
                        ${
                          question.image
                            ? `
                            <div class="mb-4">
                                <img src="${question.image}" class="image-preview w-full max-w-md mx-auto border border-gray-200">
                            </div>
                         `
                            : ""
                        }
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div class="flex items-center p-3 rounded-lg ${
                              question.correctAnswer === "A"
                                ? "bg-green-50 border border-green-200"
                                : "bg-gray-50 border border-gray-200"
                            }">
                                <div class="choice-circle ${
                                  question.correctAnswer === "A"
                                    ? "bg-green-500"
                                    : "bg-blue-500"
                                } mr-3">A</div>
                                <span class="${
                                  question.correctAnswer === "A"
                                    ? "font-medium text-green-700"
                                    : "text-gray-700"
                                }">${question.choices.A}</span>
                            </div>
                            <div class="flex items-center p-3 rounded-lg ${
                              question.correctAnswer === "B"
                                ? "bg-green-50 border border-green-200"
                                : "bg-gray-50 border border-gray-200"
                            }">
                                <div class="choice-circle ${
                                  question.correctAnswer === "B"
                                    ? "bg-green-500"
                                    : "bg-green-500"
                                } mr-3">B</div>
                                <span class="${
                                  question.correctAnswer === "B"
                                    ? "font-medium text-green-700"
                                    : "text-gray-700"
                                }">${question.choices.B}</span>
                            </div>
                            <div class="flex items-center p-3 rounded-lg ${
                              question.correctAnswer === "C"
                                ? "bg-green-50 border border-green-200"
                                : "bg-gray-50 border border-gray-200"
                            }">
                                <div class="choice-circle ${
                                  question.correctAnswer === "C"
                                    ? "bg-green-500"
                                    : "bg-yellow-500"
                                } mr-3">C</div>
                                <span class="${
                                  question.correctAnswer === "C"
                                    ? "font-medium text-green-700"
                                    : "text-gray-700"
                                }">${question.choices.C}</span>
                            </div>
                            <div class="flex items-center p-3 rounded-lg ${
                              question.correctAnswer === "D"
                                ? "bg-green-50 border border-green-200"
                                : "bg-gray-50 border border-gray-200"
                            }">
                                <div class="choice-circle ${
                                  question.correctAnswer === "D"
                                    ? "bg-green-500"
                                    : "bg-red-500"
                                } mr-3">D</div>
                                <span class="${
                                  question.correctAnswer === "D"
                                    ? "font-medium text-green-700"
                                    : "text-gray-700"
                                }">${question.choices.D}</span>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-3 border-t border-gray-200 text-sm text-gray-500">
                            Correct answer: <span class="font-medium text-green-600">${
                              question.correctAnswer
                            }</span>
                        </div>
                    </div>
                `;
        });

        previewHTML += `</div>`;
        previewContent.innerHTML = previewHTML;
      }

      // Clear all questions
      function clearAllQuestions() {
        if (
          questions.length === 0 ||
          !confirm("Are you sure you want to clear all questions?")
        ) {
          return;
        }

        questions = [];
        saveToLocalStorage();

        // Clear UI
        questionsList.innerHTML = emptyState.outerHTML;
        emptyState.classList.remove("hidden");

        // Update counts
        updateQuestionCount();
        updateEditQuestionCount();
      }

      // Update question count
      function updateQuestionCount() {
        questionCount.textContent = questions.length;
      }

      // Update edit question count
      function updateEditQuestionCount() {
        editQuestionCount.textContent = questions.length;
      }

      // Save to local storage
      function saveToLocalStorage() {
        localStorage.setItem("questionBank", JSON.stringify(questions));
      }

      // Load from local storage
      function loadFromLocalStorage() {
        const savedQuestions = localStorage.getItem("questionBank");
        if (savedQuestions) {
          questions = JSON.parse(savedQuestions);

          // Render existing questions
          questions.forEach((question) => {
            renderQuestion(question);
          });

          // Render edit questions if we're on that tab
          if (
            document.querySelector(
              '.tab-btn[data-tab="edit"].border-purple-600'
            )
          ) {
            renderEditQuestions();
          }
        }
      }

      // Initialize the app
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
